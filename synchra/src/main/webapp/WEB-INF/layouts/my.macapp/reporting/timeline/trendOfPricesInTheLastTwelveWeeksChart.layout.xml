<?xml version="1.0" encoding="utf-8" ?>

<config:template-call
	xmlns:config="http://www.top-logic.com/ns/config/6.0"
	final="true"
	template="com.top_logic.chart.chartjs/chartjs.template.xml"
>
	<arguments model="selection(my.macapp/reporting/timeline/structureGrid.layout.xml#Grid)">
		<name key="dynamic.59de1715-3f3b-4fa2-afce-4f7e461a6d0e">
			<en>Trend of prices in the last twelve weeks</en>
			<de>Verlaufskurve des Preises in den letzten 12 Wochen</de>
		</name>
		<data><![CDATA[product -> 
{
	'type': 'line',
	'data': {
	    'labels': (count(-77,7,7).map(y -> now().toUserCalendar().withDayAdded
	                    ($y).toDate().toString())),
		'datasets': [
		    {
		        'label': 'Planpreis',
			    'data': (count(-77,7,7).map(y -> now().toUserCalendar().
			    withDayAdded($y).toDate().revisionAt()))
			    .map(rev->switch
			    {$product.instanceOf(`PDX.Bom:Composition`):
			    $product.inRevision($rev).get(`PDX.Bom:Composition#price`);
                 $product.instanceOf(`PDX.Bom:ConstructionPart`):
                 $product.inRevision($rev).get(`PDX.Bom:ConstructionPart#price`);
                },)
			    
		    }
		    /*
		    {
		        'label': 'Zielpreis',
			    'data': [20, 40, 10]
		    }
		    */
		]
	},
	'options': {
		'maintainAspectRatio': false,
		'plugins': {
            'colorschemes': {
            	// See https://nagix.github.io/chartjs-plugin-colorschemes/colorchart.html
                'scheme': 'tableau.Tableau10'
            }
        },
		'scales': {
		    'y': {
			    'ticks': {
			        'min': 0
			    }
		    },
			'x': {
				'gridLines': {
					'offsetGridLines': true
				}
			}
		}
	}
}]]></data>
	</arguments>
</config:template-call>