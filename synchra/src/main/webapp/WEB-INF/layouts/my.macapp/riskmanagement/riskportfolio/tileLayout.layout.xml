<?xml version="1.0" encoding="utf-8" ?>

<config:template-call
	xmlns:config="http://www.top-logic.com/ns/config/6.0"
	final="true"
	template="com.top_logic.chart.chartjs/tileChartjs.template.xml"
>
	<arguments
		helpID="ID_8e31b39e_77df_4eec_b6ec_2ffdd02ba585"
		tileName="ID_502e91c4_d3d0_4d5f_8c94_c3f3548c0959"
	>
		<name key="dynamic.7464b332-7c02-4604-94a4-296e0ce5225e">
			<en>Riskportfolio</en>
			<de>Risikoportfolio vor MN</de>
		</name>
		<model class="com.top_logic.layout.channel.linking.impl.ProviderLinking">
			<script expr="all (`PDX.Riskmanagement:Risk`)"/>
		</model>
		<chartDescription key="dynamic.0723a37b-7ff7-4d51-89dc-002b8eff0f6b">
			<en>Risks for its own</en>
			<de>Risiken vor MN</de>
		</chartDescription>
		<data><![CDATA[
    nodes->{
    // bubble chart with individual dataset for each node
    
    // define color set by creating a map by enum literal and color
    colors = {
    `PDX.Riskmanagement:RiskClass#low`: "rgba(0,255,0,0.5)",
    `PDX.Riskmanagement:RiskClass#middle`: "rgba(255, 255, 0, 0.5)",
    `PDX.Riskmanagement:RiskClass#high`: "rgba(255, 0, 0, 0.5)"
    };
    
    // define reskeys for axis labels
    xAxisLabel = #("Eintrittswahrscheinlichkeit"@de, "Probability"@en);
    yAxisLabel = #("Auswirkung in Tâ‚¬"@de, "Impact"@en);
    
    // define limits for dynamic bubble size calculation
    minRadius = 15;
    maxRadius = 35;
    
    // compute data for the chart configuration. create one dataset for each node with individual label and color
    datasets = $nodes.map(x-> {
    'label': $x.get(`PDX.Riskmanagement:Risk#name`),
    'backgroundColor': $colors[$x.get(`PDX.Riskmanagement:Risk#hasClass`)],
    'data':  [{
    'x': $x.get(`PDX.Riskmanagement:Risk#probAsNumber`),
    'y': $x.get(`PDX.Riskmanagement:Risk#lossAsNumber`),
    'r': 15
    }]
    });
    
    // chart configuration
    chart = {
    'type': 'bubble',
    'data': {
    'datasets': $datasets
    },
    'options': {
    'maintainAspectRatio': false,
    'scales': {
    'x':{
    'min': -10,
    'max': 110,
    'title': {
    'display': true,
    'text': $xAxisLabel
    },
    'ticks': {
    'precision': 0
    }
    },
    'y':{
    'min': -10,
    'max': 300,
    'title': {
    'display': true,
    'text': $yAxisLabel
    },
    'ticks': {
    'precision': 0
    }
    }
    },
    'plugins': {
    'legend': {
    'display': false
    
    }
    }
    }
    }; $chart
    }
  ]]></data>
	</arguments>
</config:template-call>