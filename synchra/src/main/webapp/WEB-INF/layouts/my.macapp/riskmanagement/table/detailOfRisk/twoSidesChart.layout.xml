<?xml version="1.0" encoding="utf-8" ?>

<config:template-call
	xmlns:config="http://www.top-logic.com/ns/config/6.0"
	final="true"
	template="com.top_logic.chart.chartjs/chartjs.template.xml"
>
	<arguments model="model(my.macapp/riskmanagement/table/detailOfRisk/detailOfRiskForm.layout.xml#Form)">
		<name key="dynamic.b69af5ec-32e8-4997-bd46-35ec1f8a8dac">
			<en>Two sides</en>
			<de>Vorher-Nacher</de>
		</name>
		<data><![CDATA[
    nodes->{
    // bubble chart with individual dataset for each node
    
    // define color set by creating a map by enum literal and color
    colors = {
    `PDX.Riskmanagement:RiskClass#low`: "rgba(0,255,0,0.5)",
    `PDX.Riskmanagement:RiskClass#middle`: "rgba(255, 255, 0, 0.5)",
    `PDX.Riskmanagement:RiskClass#high`: "rgba(255, 0, 0, 0.5)"
    };
    
    // define reskeys for axis labels
    xAxisLabel = #("Eintrittswahrscheinlichkeit"@de, "Probability"@en);
    yAxisLabel = #("Auswirkung in Tâ‚¬"@de, "Impact"@en);
    
    // define limits for dynamic bubble size calculation
    minRadius = 15;
    maxRadius = 35;
    
    // compute data for the chart configuration. create one dataset for each node with individual label and color
    x = $nodes;
    
    datasets = [
    {
    'label': $x.get(`PDX.Riskmanagement:Risk#name`)+" vor MN",
    'data':  [{
    'x': $x.get(`PDX.Riskmanagement:Risk#probAsNumber`),
    'y': $x.get(`PDX.Riskmanagement:Risk#lossAsNumber`),
    'r': 25
    }],
    'backgroundColor': $colors[$x.get(`PDX.Riskmanagement:Risk#hasClass`)]
    },
    {
    'label': $x.get(`PDX.Riskmanagement:Risk#name`)+" nach MN",
    'data':  [{
    'x': $x.get(`PDX.Riskmanagement:Risk#probAsNumberAfter`),
    'y': $x.get(`PDX.Riskmanagement:Risk#lossAsNumberAfter`),
    'r': 25
    }],
    'backgroundColor': $colors[$x.get(`PDX.Riskmanagement:Risk#hasClassAfter`)]
    }
    ];
    
    // chart configuration
    chart = {
    'type': 'bubble',
    'data': {
    'datasets': $datasets
    },
    'options': {
    'maintainAspectRatio': false,
    'scales': {
    'x':{
    'min': -10,
    'max': 110,
    'title': {
    'display': true,
    'text': $xAxisLabel
    },
    'ticks': {
    'precision': 0
    }
    },
    'y':{
    'min': -10,
    'max': 300,
    'title': {
    'display': true,
    'text': $yAxisLabel
    },
    'ticks': {
    'precision': 0
    }
    }
    },
    'plugins': {
    'legend': {
    'display': true
    }
    }
    }
    };$chart
    }
  ]]></data>
	</arguments>
</config:template-call>