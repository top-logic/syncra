<?xml version="1.0" encoding="utf-8" ?>

<config:template-call
	xmlns:config="http://www.top-logic.com/ns/config/6.0"
	template="com.top_logic.element/treegrid.template.xml"
>
	<arguments
		defaultColumns="name,material,tType"
		rootVisible="false"
		type="fma:PartCatalog,fma:SinglePart"
	>
		<name key="dynamic.11a9f4d4-ab1a-4368-a6e8-0c8dfc54c709">
			<de>Kataloge</de>
		</name>
		<modelBuilder class="com.top_logic.model.search.providers.TreeModelByExpression"
			leafPredicate="node->$node.instanceOf(`fma:SinglePart`)"
			nodePredicate="node->$node.instanceOf(`fma:PartCatalog`) or $node.instanceOf(`fma:SinglePart`)"
			rootNode="`synchra.Bom#LIBRARIES`"
		>
			<children><![CDATA[node -> switch {
    $node.instanceOf(`synchra.Bom:Libraries`): all(`fma:PartCatalog`);
    $node.instanceOf(`fma:PartCatalog`):$node.get(`fma:PartCatalog#parts`);
}]]></children>
			<parents><![CDATA[node -> switch {
    $node.instanceOf(`synchra.Bom:Libraries`): null;
    $node.instanceOf(`fma:PartCatalog`):`synchra.Bom#LIBRARIES`;
    $node.instanceOf(`fma:SinglePart`):$node.container();
}]]></parents>
		</modelBuilder>
		<buttons>
			<button id="exportExcelGrid"
				class="com.top_logic.layout.table.export.StreamingExcelExportHandler"
			/>
			<button id="createNewRow"
				class="com.top_logic.model.search.providers.GridCreateHandlerByExpression"
				createContext="model -> $model"
				initOperation="createContext -> newObject -> target -> $createContext.add(`fma:PartCatalog#parts`, $newObject)"
				target="selection(self())"
			>
				<checkScopeProvider/>
				<type-options class="com.top_logic.element.layout.create.AttributeBasedCreateTypeOptions"
					attribute="fma:PartCatalog#parts"
					owner="fma:PartCatalog"
				/>
			</button>
			<button id="importCatalogs"
				class="com.top_logic.synchra.util.OpenImportCatalogsDialog"
				executability="InViewMode"
				group="Write"
				image="css:fa-solid fa-file-import"
			>
				<resourceKey key="dynamic.659fe5c1-02b9-4560-9146-31e154fe76b9">
					<en>Import data</en>
					<de>Daten importieren</de>
				</resourceKey>
				<importers>
					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="fma:Material" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Material#name" />
						</attributes>
					</importer>
					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="fma:PartCatalog" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:PartCatalog#name" />
						</attributes>
					</importer>

					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="fma:Company" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Company#name" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Company#contactPerson" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Company#phone" />
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:Company#structure" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLEnumerationTransformer"  enumeration="fma:CompanyStructure"/>
							</attribute>
						</attributes>
					</importer>

					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="fma:SinglePart" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:SinglePart#name" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:SinglePart#price" />
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:SinglePart#material" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:Material" id-attribute ="name"/>
							</attribute>
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:SinglePart#catalog" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:PartCatalog" id-attribute ="name"/>
							</attribute>
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:SinglePart#company" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:Company" id-attribute ="name"/>
							</attribute>
						</attributes>
					</importer>
					
					<importer class="com.top_logic.synchra.importer.ProductImporter" 
						id-attributes ="name"
						tl-class="fma:Product" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Product#name" />
						</attributes>
					</importer>
					
					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="fma:Activity" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Activity#name" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Activity#costs" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Activity#riskProbImpact" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Activity#riskCostImpact" />
						</attributes>
					</importer>
					
					
					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="risk:Risk" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="risk:Risk#name" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="risk:Risk#estimatedDamage" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="risk:Risk#estimatedProbability" />
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="risk:Risk#activities" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:Activity" id-attribute ="name"/>
							</attribute>
						</attributes>
					</importer>					
					
					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="name"
						tl-class="fma:Problem" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Problem#name" />
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:Problem#solvingActivities" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:Activity" id-attribute ="name"/>
							</attribute>
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:Problem#components" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:SinglePart" id-attribute ="name"/>
							</attribute>
						</attributes>
					</importer>

					<importer class="com.top_logic.synchra.importer.TypeImporter" 
						id-attributes ="consistsOf,used,rule,position"
						tl-class="fma:Connection" >
						<attributes>
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Connection#position" />
							<attribute class="com.top_logic.synchra.importer.attribute.PropertyImport" name="fma:Connection#rule" />
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:Connection#consistsOf" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:Component" id-attribute ="name" create-tl-class="fma:ConstructionGroup"/>
							</attribute>
							<attribute class="com.top_logic.synchra.importer.attribute.ReferenceImport" name="fma:Connection#used" >
								<value-transformer class="com.top_logic.synchra.importer.transformer.TLObjectTransformer"  tl-class="fma:ConstructionGroup" id-attribute ="name" />
							</attribute>
						</attributes>
					</importer>
				</importers>
			</button>
		</buttons>
	</arguments>
</config:template-call>